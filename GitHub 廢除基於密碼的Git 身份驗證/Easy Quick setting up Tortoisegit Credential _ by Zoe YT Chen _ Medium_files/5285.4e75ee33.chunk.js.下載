(self.webpackChunklite=self.webpackChunklite||[]).push([[5285],{35285:(e,t,n)=>{"use strict";n.d(t,{fY:()=>F,xe:()=>H,WI:()=>B});var r,a=n(28655),i=n.n(a),o=n(63038),l=n.n(o),u=n(46829),c=n(71439),s=n(58875),d=n.n(s),m=n(67294),p=n(76532),f=n(42933),h=n(82318),g=n(98024),x=n(95760),v=n(6688),E=n(79208),b=n(90038),I=function(e){return{backgroundColor:e.baseColor.background.light,borderColor:e.baseColor.border.light,borderRadius:"3px",borderWidth:"1px",alignItems:"center",padding:"25px 20px 25px 20px",marginTop:"",borderStyle:"solid"}},w=function(){var e=(0,v.I)();return m.createElement("div",{className:e([y,I])},m.createElement(f.x,{textAlign:"center"},m.createElement(f.x,null,"1000 x 1000"),m.createElement(f.x,null,"pixels")))},k=function(){return m.createElement(f.x,{marginRight:"5px",display:"inline-block"},m.createElement(g.F,{scale:"S",color:"ERROR"},"That file doesn't meet our requirements. Try another."))},C=function(){return m.createElement(f.x,{marginTop:"8px"},m.createElement(f.x,{marginRight:"5px",display:"inline-block"},m.createElement(g.F,{scale:"S",color:"ERROR"},"We couldn't process your request.")),m.createElement(f.x,{marginRight:"5px",display:"inline-block"},m.createElement(g.F,{scale:"S"},"Try again, or"," ",m.createElement(h.r,{inline:!0,linkStyle:"OBVIOUS",href:"https://help.medium.com/hc/en-us"},"search our help center for support."))))};!function(e){e.Success="success",e.UploadError="uploadError",e.InvalidError="invalidError"}(r||(r={}));var y={height:"132px",width:"132px",display:"flex",flexDirection:"row",justifyContent:"center"},S=function(e){var t=e.setImageId,n=e.initialImageId,a=e.source,i=(0,v.I)(),o=(0,x.Av)(),u=(0,p.H)().value,c=m.useState({imageId:n,imageWidth:0,imageHeight:0}),s=l()(c,2),d=s[0],g=s[1],I=m.useState(null),S=l()(I,2),D=S[0],O=S[1],R=function(e){O(e),o.event("user.updateAvatarResult",{userId:null==u?void 0:u.id,source:a,uploadResult:e})},N=(0,E.JA)((function(e,n,a){var i=n.height,o=n.width,l=e.value.fileId;g({imageId:l,imageHeight:i,imageWidth:o}),i<parseInt("1000px",10)||o<parseInt("1000px",10)?(R(r.InvalidError),U()):(t(l),R(r.Success),a())}),(function(){R(r.UploadError)}),(function(){R(r.InvalidError)})),P=N.inputRef,A=N.fireClick,T=function(){o.event("user.updateAvatarClick",{userId:null==u?void 0:u.id,source:a,hasImage:!!d.imageId}),A()},U=function(){g({imageId:"",imageWidth:0,imageHeight:0}),t("")},L=m.useCallback((function(){return m.createElement(f.x,{marginBottom:"10px"},m.createElement("input",{type:"file","aria-hidden":"true",ref:P,className:i({display:"none"})}),m.createElement(h.r,{inline:!0,linkStyle:"OBVIOUS",onClick:T},"Add photo"))}),[i,T,P]),B=m.useCallback((function(){return m.createElement("div",{className:i([y])},m.createElement("div",{className:i((function(){return{backgroundImage:"url(".concat((0,b.W6)({miroId:d.imageId||"",width:d.imageWidth||0,height:d.imageHeight||0}),")"),backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"contain",height:"100%",width:"100%",borderRadius:"3px",display:"flex",flexDirection:"row"}}))}))}),[i,d]),F=m.useCallback((function(){return m.createElement(f.x,{display:"inline-block",marginBottom:"15px"},d.imageId?m.createElement(B,null):m.createElement(w,null))}),[d]);return m.createElement(f.x,{display:"flex",flexDirection:"column",maxWidth:"132px"},m.createElement(f.x,{display:"inline-block",float:"right"},m.createElement(F,null)),m.createElement(L,null),D===r.UploadError&&m.createElement(C,null),D===r.InvalidError&&m.createElement(k,null))},D=n(48573),O=function(e){var t=e.label,n=e.onChangeFn,r=e.onBlurFn,a=e.value,i=e.errorMessage,o=e.characterCountLimit;return m.createElement(m.Fragment,null,m.createElement(f.x,{marginBottom:"15px",textAlign:"left"},m.createElement(g.F,{scale:"L",tag:"h4"},t)),m.createElement(D.n,{scale:"L",onChange:n,value:a,errorMessage:i,onBlur:r,ariaLabel:t,characterCountLimit:o}))},R=n(92528),N=n(29035);function P(){var e=i()(["\n  mutation userCompleteProfileMutation(\n    $userId: ID!\n    $name: String!\n    $bio: String!\n    $imageId: String!\n  ) {\n    userCompleteProfile(userId: $userId, name: $name, bio: $bio, imageId: $imageId)\n  }\n"]);return P=function(){return e},e}function A(){var e=i()(["\n  fragment UserCompleteProfileDialog_user on User {\n    id\n    name\n    bio\n    imageId\n    hasCompletedProfile\n  }\n"]);return A=function(){return e},e}var T={min:3,max:50,message:"Please try another name that’s between 3 and 50 characters."},U={min:10,max:160,message:"Please try another description that’s between 10 and 160 characters."},L=function(e,t){var n=e.min,r=e.max,a=e.message;return function(e){var i=e.target.value;t(i.length<n||i.length>r?a:void 0)}},B=function(e){var t=(0,p.H)().value;return e?{shouldShowDialog:d().canUseDOM&&!(0,N.ic)(navigator.userAgent)&&(null==t?void 0:t.id)===e.id}:{shouldShowDialog:!1}},F=function(e){var t=e.setHasCompletedProfile,n=e.user,r=e.confirmText,a=void 0===r?"Continue":r,i=(0,x.Av)(),o=(0,p.H)().value,u=m.useState(!1),c=l()(u,2),s=c[0],d=c[1],h=W(),v=l()(h,1)[0],E=m.useState((null==n?void 0:n.imageId)||""),b=l()(E,2),I=b[0],w=b[1],k=m.useState((null==n?void 0:n.name)||""),C=l()(k,2),y=C[0],D=C[1],N=m.useState((null==n?void 0:n.bio)||""),P=l()(N,2),A=P[0],F=P[1],H=m.useState(),$=l()(H,2),M=$[0],j=$[1],G=m.useState(),J=l()(G,2),V=J[0],q=J[1],X=L(T,j),z=L(U,q),K=m.useCallback((function(){o&&(d(!0),i.event("user.completedProfile",{userId:o.id,changedName:(null==n?void 0:n.name)!==y,changedBio:(null==n?void 0:n.bio)!==A,changedImage:(null==n?void 0:n.imageId)!==I,hasName:!!y,hasBio:!!A,hasImage:!!I}),v({variables:{userId:o.id,name:y,bio:A,imageId:I}}).then((function(){d(!1),t(!0)})))}),[o,v,d,n,y,A,I]),Q=B(n).shouldShowDialog;return m.useEffect((function(){Q&&i.event("user.presentedCompleteProfileDialog",{userId:null==o?void 0:o.id})}),[Q]),Q?m.createElement(m.Fragment,null,m.createElement(R.Q,{confirmText:a,titleText:"Complete your profile",isDestructiveAction:!1,onConfirm:K,isVisible:!0,hide:function(){},withCloseButton:!1,showCancelButton:!1,disableConfirm:s},m.createElement(g.F,{scale:"L",color:"DARKER"},"Readers like learning a bit more about their writers"),m.createElement(f.x,{marginTop:"48px",marginBottom:"28px",display:"flex",flexDirection:"row"},m.createElement(f.x,{overflow:"visible",maxHeight:"200px"},m.createElement(S,{setImageId:w,initialImageId:I,source:"userCompleteProfileDialog"})),m.createElement(f.x,{marginLeft:"48px",textAlign:"left"},m.createElement(f.x,{key:"name"},m.createElement(O,{label:"Full name",onChangeFn:function(e){return D(e.target.value)},onBlurFn:X,value:y,errorMessage:M})),m.createElement(f.x,{key:"bio",marginTop:"40px"},m.createElement(O,{label:"Bio (optional, max 160 characters)",onChangeFn:function(e){return F(e.target.value)},onBlurFn:z,value:A,errorMessage:V,characterCountLimit:160})))))):null},H=(0,c.Ps)(A()),W=function(){return(0,u.useMutation)($)},$=(0,c.Ps)(P())},79208:(e,t,n)=>{"use strict";n.d(t,{Dm:()=>r,JA:()=>b});var r,a=n(63038),i=n.n(a),o=n(87757),l=n.n(o),u=n(48926),c=n.n(u),s=n(94301),d=n.n(s),m=n(67294),p=n(61250);!function(e){e[e.NONE=0]="NONE",e[e.STARTING=1]="STARTING",e[e.UPLOADING=2]="UPLOADING",e[e.UPLOADED=3]="UPLOADED"}(r||(r={}));var f=new Set(["jpg","jpeg","png","gif"]),h=function(e){return new Promise((function(t){return setTimeout(t,e)}))},g=function(){var e=c()(l().mark((function e(t,n){var r,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d()(t,{credentials:"same-origin",method:"POST",headers:{accept:"application/json","Content-Type":"application/json","x-xsrf-token":"1","X-Obvious-CID":"web"},body:JSON.stringify({url:n})});case 2:return r=e.sent,e.next=5,r.text();case 5:return a=e.sent,e.abrupt("return",JSON.parse(a.replace("])}while(1);</x>","")));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),x=function(){var e=c()(l().mark((function e(t,n){var r,a,i;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new FormData).append("uploadedFile",n),e.next=4,d()(t,{credentials:"same-origin",method:"POST",headers:{"x-xsrf-token":"1","X-Obvious-CID":"web"},body:r});case 4:return a=e.sent,e.next=7,a.text();case 7:return i=e.sent,e.abrupt("return",JSON.parse(i.replace("])}while(1);</x>","")));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),v="CreateUpload",E=new Error("Image upload failed. The URL you provided may be invalid."),b=function(e,t,n){var a=m.useState(r.NONE),o=i()(a,2),u=o[0],s=o[1],d=m.useRef(null),b=m.useCallback((function(){d.current&&d.current.click()}),[d.current]),I=(0,p.BS)(v),w=(0,p.BS)("CreateUploadUrl");function k(){return C.apply(this,arguments)}function C(){return(C=c()(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s(r.STARTING),e.next=3,h(0);case 3:s(r.UPLOADING);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=c()(l().mark((function n(a){var i,o,u,c,d;return l().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k();case 2:if(n.prev=2,w){n.next=5;break}throw new Error("Expected ".concat(v," route to exist"));case 5:return n.next=7,g(w.pathPattern,a);case 7:o=n.sent,u=o.success,c=o.payload,u&&null!=c&&null!==(i=c.value)&&void 0!==i&&i.fileId?((d=new Image).onload=function(){s(r.UPLOADED),e(c,{url:a,height:d.height,width:d.width},(function(){return s(r.NONE)}))},d.onerror=function(){t(E)},d.src=a):t(E),n.next=15;break;case 12:n.prev=12,n.t0=n.catch(2),t(n.t0);case 15:case"end":return n.stop()}}),n,null,[[2,12]])})))).apply(this,arguments)}function S(e){return D.apply(this,arguments)}function D(){return(D=c()(l().mark((function a(i){var o,u,c,d,m,p,h,g;return l().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=null==i?void 0:i[0]){a.next=3;break}return a.abrupt("return");case 3:if(u=o.name.split(".").pop(),f.has((null==u?void 0:u.toLowerCase())||"")){a.next=7;break}return n&&n(),a.abrupt("return");case 7:return a.next=9,k();case 9:if(a.prev=9,I){a.next=12;break}throw new Error("Expected ".concat(v," route to exist"));case 12:return a.next=14,x(I.pathPattern,o);case 14:d=a.sent,m=d.success,p=d.payload,m&&null!=p&&null!==(c=p.value)&&void 0!==c&&c.md5&&(h=URL.createObjectURL(o),(g=new Image).onload=function(){s(r.UPLOADED),e(p,{file:o,height:g.height,width:g.width},(function(){return s(r.NONE)}))},g.src=h),a.next=22;break;case 19:a.prev=19,a.t0=a.catch(9),t(a.t0);case 22:case"end":return a.stop()}}),a,null,[[9,19]])})))).apply(this,arguments)}function O(){S(this.files),this.value=""}return m.useEffect((function(){if(d.current)return d.current.addEventListener("change",O),function(){d.current&&d.current.removeEventListener("change",O)}}),[d.current]),{inputRef:d,fireClick:b,status:u,handleDropEvent:function(e){var t=e.dataTransfer;t&&S(t.files)},uploadUrl:function(e){return y.apply(this,arguments)}}}}}]);
//# sourceMappingURL=https://stats.medium.build/lite/sourcemaps/5285.4e75ee33.chunk.js.map